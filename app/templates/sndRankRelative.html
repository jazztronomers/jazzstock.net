{% extends "layout.html" %}

{% block content %}

<link href="static/css/nouislider.css" rel="stylesheet">
<script src="static/js/nouislider.js"></script>
<script src="static/js/sorttable.js"></script>
<script language="javascript">



if(localStorage.getItem("checked_window")!=null){
var q = localStorage.getItem("checked_window").split(',')
}
else q = ['S','Y']


function checkCheckbox(frm,obj,num) {

    var window = document.getElementsByName("window");

    if(obj.checked){
        q.push(obj.value)
    }

    else{

        for(var j=0; j<q.length;j++){
            if(q[j]==obj.value){
                q.splice(j,1)
            }
        }

    }


    if(q.length>num){
        q.shift()
    }


    for (var i=0; i< window.length; i++){

        if(window[i].type == 'checkbox' && q.includes(window[i].value)){
            window[i].checked=true
        }

        else{
            window[i].checked=false
        }
    }
}


function setStorage(){
    var q_window = [];
    var q_interval = [];
    var q_order = [];
    var q_market = [];
    var q_range = [];

    var window = document.getElementsByName("window");
    for (var i = 0; i < window.length; i++){

        if(window[i].type =='checkbox' && window[i].checked == true)
        {
            q_window.push(window[i].value)
        }
    }


    var interval = document.getElementsByName("interval");
    for (var i = 0; i < interval.length; i++){

        if(interval[i].type =='checkbox' && interval[i].checked == true)
        {
            q_interval.push(interval[i].value)
        }
    }

    var market = document.getElementsByName("market");
    for (var i = 0; i < market.length; i++){

        if(market[i].type =='checkbox' && market[i].checked == true)
        {
            q_market.push(market[i].value)
        }
    }

    var range = document.getElementsByName("range");
    for (var i = 0; i < range.length; i++){

        if(range[i].type =='checkbox' && range[i].checked == true)
        {
            q_range.push(range[i].value)
        }
    }


    var order = document.getElementsByName("order");
    selectedorderindex = order[0].selectedIndex

    localStorage.setItem("checked_window",q_window);
    localStorage.setItem("checked_interval",q_interval);
    localStorage.setItem("checked_market",q_market);
    localStorage.setItem("selected_order_index",selectedorderindex);
    localStorage.setItem("checked_range",q_range);
}

function onload(){

    if(localStorage.getItem("checked_window")!=null){
    var q_window = localStorage.getItem("checked_window").split(',')
    }
    else q_window = ['S','Y']

    if(localStorage.getItem("checked_interval")!=null){
    var q_interval = localStorage.getItem("checked_interval").split(',')
    }
    else q_interval = ['1','5','20']

    if(localStorage.getItem("selected_order_index")!=null){
    var selectedorder = localStorage.getItem("selected_order_index")
    }
    else selectedorder = 0


    if(localStorage.getItem("checked_range")!=null){
    var q_range = localStorage.getItem("checked_range").split(',')
    }
    else q_range = ['0:0.8','0.8:2','2:4','4:8','8:10','10:500']


    if(localStorage.getItem("checked_market")!=null){
    var q_market = localStorage.getItem("checked_market").split(',')
    }
    else q_market = ['0','1']


    var window = document.getElementsByName("window");
    for (var i = 0; i < window.length; i++)
    {


        if(window[i].type =='checkbox' && q_window.includes(window[i].value)){
            window[i].checked=true
        }
    }

    var interval = document.getElementsByName("interval");
    for (var i = 0; i < interval.length; i++)
    {

        if(interval[i].type =='checkbox' && q_interval.includes(interval[i].value)){
            interval[i].checked=true
        }
    }

    document.getElementsByName("order")[0].selectedIndex = selectedorder;

    var market = document.getElementsByName("market");
    for (var i = 0; i < market.length; i++)
    {


        if(market[i].type =='checkbox' && q_market.includes(market[i].value)){
            market[i].checked=true
        }
    }


    var range = document.getElementsByName("range");
    for (var i = 0; i < range.length; i++)
    {


        if(range[i].type =='checkbox' && q_range.includes(range[i].value)){
            range[i].checked=true
        }
    }


    }



</script>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.js"></script>


<body onload="onload()">
<form method="post" name="form_name" id="form_name">
    <div class="selection">
        <div class="row">
            <div class="col-25">
                WINDOW :
            </div>
            <div class="col-75">
                <input type="checkbox" name="window" value="S" autocomplete="off" onClick="checkCheckbox(this.form,this,2)"> 사모
                <input type="checkbox" name="window" value="YG" autocomplete="off" onClick="checkCheckbox(this.form,this,2)"> 연기금
                <input type="checkbox" name="window" value="T"  autocomplete="off"  onClick="checkCheckbox(this.form,this,2)"> 투신
                <input type="checkbox" name="window" value="FN" autocomplete="off" onClick="checkCheckbox(this.form,this,2)"> 금융
                 <input type="checkbox" name="window" value="IS" autocomplete="off" onClick="checkCheckbox(this.form,this,2)"> 보험
                 <input type="checkbox" name="window" value="NT" autocomplete="off" onClick="checkCheckbox(this.form,this,2)"> 국가
                 <input type="checkbox" name="window" value="BK" autocomplete="off" onClick="checkCheckbox(this.form,this,2)"> 은행
                 <input type="checkbox" name="window" value="OC" autocomplete="off" onClick="checkCheckbox(this.form,this,2)"> 기타법인
                 <input type="checkbox" name="window" value="PS" autocomplete="off" onClick="checkCheckbox(this.form,this,2)"> 개인
            </div>
        </div>

        <div class="row">
            <div class="col-25">
                INTERVAL :
            </div>
            <div class="col-75">
                <input type="checkbox" name="interval" value="1" autocomplete="off"  onClick="checkCheckbox(this.form,this,3)"> 1
                <input type="checkbox" name="interval" value="3"  autocomplete="off" onClick="checkCheckbox(this.form,this,3)"> 3
                <input type="checkbox" name="interval" value="5" autocomplete="off" onClick="checkCheckbox(this.form,this,3)"> 5
                <input type="checkbox" name="interval" value="20" autocomplete="off" onClick="checkCheckbox(this.form,this,3)"> 20
                <input type="checkbox" name="interval" value="60" autocomplete="off" onClick="checkCheckbox(this.form,this,3)"> 60<br>
            </div>
        </div>

        <div class="row">
            <div class="col-25">
                MARKET :
            </div>
            <div class="col-75">
                <input type="checkbox" name="market" value="0" autocomplete="off"  onClick="checkCheckbox(this.form,this,3)"> KOSPI
                <input type="checkbox" name="market" value="1"  autocomplete="off" onClick="checkCheckbox(this.form,this,3)"> KOSDAQ

            </div>
        </div>


        <div class="row">
            <div class="col-25">
                MC RANGE :
            </div>
            <div class="col-75">
                <input type="checkbox" name="range" value="0:0.8" autocomplete="off"> 0~0.8
                <input type="checkbox" name="range" value="0.8:2"  autocomplete="off"> 0.8~2
                <input type="checkbox" name="range" value="2:4" autocomplete="off"> 2~4
                <input type="checkbox" name="range" value="4:8"  autocomplete="off"> 4~8
                <input type="checkbox" name="range" value="8:10" autocomplete="off"> 8~10
                <input type="checkbox" name="range" value="10:500"  autocomplete="off"> 12~   (천억)

            </div>
        </div>




        <div class="row">
            <div class="col-25">
             ORDER BY :
            </div>
            <div class="col-75">


                 <select name="order">
                  <option value="I">기관</option>
                  <option value="F">외인</option>
                  <option value="S">사모펀드</option>
                  <option value="YG">연기금</option>
                  <option value="T">투신</option>
                  <option value="FN">금융</option>
                  <option value="IS">보험</option>
                  <option value="NT">국가</option>
                  <option value="BK">은행</option>
                  <option value="OC">기타법인</option>
                  <option value="PS">개인</option>
                </select>

                 <select name="by">
                  <option value="DESC">내림차순</option>
                  <option value="ASC">오름차순</option>

                </select>

            </div>
        </div>


        <div class="row">
            <div class="col-25">
                DATE (NOT YET) :
            </div>
            <div class="col-75">
                <input type="date" name='date' min="2019-01-01" value="{{date}}">
                <input type="submit" value="검색" onclick="setStorage()">
            </div>
        </div>


    </div>
</form>
<br>

    <table id="sndrank" class="sortable">
        <tr>

            {% for eachcol in column %}
                {% if eachcol !='DATE' and eachcol !='MARKET'  %}
                    <th>{{eachcol}}</th>
                {% endif %}
            {% endfor %}
        </tr>

        {% for value in sampledata.result %}


        <tr>
            {% for eachcol in column %}
                {% if eachcol =='STOCKNAME'  %}
                    <td class="firstcol">
                            <a href="{{ '/sndChart?stockcode='+ value['STOCKNAME']}}" >
                                {{ value[eachcol] }}{{value['MARKET']}}
                            </a>
                    </td>
                {% elif eachcol=='MARKET' %}


                {% elif eachcol=='MC' or eachcol =='CATEGORY' %}
                    <td nowrap>{{value[eachcol]}}</td>

                {% elif eachcol=='CLOSE' %}
                    <td class="money">{{ "{:,}".format(value[eachcol]) }}</td>

                {% elif eachcol[-1]=='R' or eachcol=='ROE'  %}
                    <td class="ranking">{{ value[eachcol] }}</td>


                {% elif eachcol!='DATE' %}


                    {% if value[eachcol] != None and value[eachcol]>=0.25 %}
                    <td class="profita" style="background-color: #f72525;">
                    {% elif value[eachcol] != None and value[eachcol]>=0.15 %}
                    <td class="profitb" style="background-color: #ff6247;">
                    {% elif value[eachcol] != None and value[eachcol]>=0.1 %}
                    <td class="profitc" style="background-color: #ff8d7a;">
                    {% elif value[eachcol] != None and value[eachcol]>=0.05 %}
                    <td class="profitd" style="background-color: #ffab9e">

                    {% elif value[eachcol] != None and value[eachcol]>=0.03 %}
                    <td class="profite" style="background-color: #ffe2dd;">
                    {% elif value[eachcol] != None and value[eachcol]>=0.02 %}
                    <td class="profite" style="background-color: #ffefed;">
                    {% elif value[eachcol] != None and value[eachcol]>=0.01 %}
                    <td class="profite" style="background-color: #fff5f4;">

                    {% elif value[eachcol] != None and value[eachcol]>=-0.01 %}
                    <td class="profite" style="background-color: #ffffff;">

                    {% elif value[eachcol] != None and value[eachcol]>=-0.02 %}
                    <td class="profite" style="background-color: #e5f0ff;">
                    {% elif value[eachcol] != None and value[eachcol]>=-0.03 %}
                    <td class="profite" style="background-color: #c2dafc;">
                    {% elif value[eachcol] != None and value[eachcol]>=-0.05 %}
                    <td class="profite" style="background-color: #a0c7ff;">

                    {% elif value[eachcol] != None and value[eachcol]>=-0.1 %}
                    <td class="profite" style="background-color: #75aeff;">
                    {% elif value[eachcol] != None and value[eachcol]>=-0.15 %}
                    <td class="profite" style="background-color: #5199ff;">
                    {% elif value[eachcol] != None and value[eachcol]>=-0.25 %}
                    <td class="profite" style="background-color: #247bf7;">
                    {% elif value[eachcol] != None and value[eachcol]<-0.25 %}
                    <td class="profite" style="background-color: #104693;">
                    {% else %}
                    <td class="profite" style="background-color: #ffffff;">



                    {% endif %}
                    {{ "%.2f"|format(value[eachcol]*100) if (value[eachcol] != None and value[eachcol]<10 and value[eachcol]>-10) else '-'}}</td>


                {% endif %}
            {% endfor %}
        </tr>
        {% endfor %}



    </table>
</div>
</body>


{% endblock %}